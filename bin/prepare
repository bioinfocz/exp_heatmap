#!/usr/bin/env python3

import os
import sys
import allel
import argparse

bin_dir = os.path.join(os.path.dirname(__file__), "..")
sys.path.append(os.path.realpath(bin_dir))

parser = argparse.ArgumentParser(
    prog="bin/prepare", description="Prepare data for computing",
)

parser.add_argument("recode_file", metavar="RECODE_FILE")

args = parser.parse_args()

if not os.path.exists(args.recode_file):
    print("File {} does not exist".format(args.recode_file))
    sys.exit(1)

name = args.recode_file.replace(".vcf", "").replace(".gz", "")

zarr_dir = name + ".zarr"

allel.vcf_to_zarr(args.recode_file, zarr_dir, fields="*", log=sys.stdout)

print()
print("ZARR dir: {}".format(zarr_dir))
