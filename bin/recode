#!/bin/bash

set -e

usage() {
  echo "USAGE: bin/extract VCF_FILE"
}

if [[ $# -ne 1 ]]; then
  echo "Wrong number or arguments"
  usage
  exit 1
fi

VCF_FILE=$1

if [[ ! -f $VCF_FILE ]]; then
  echo "$VCF_FILE does not exist or it is not a valid file"
  exit 1
fi

NAME=$(echo $VCF_FILE | sed "s/\(\.vcf\|\.gz\)//g")
RECODE_FILE="$NAME.recode.vcf"

if [[ -f $RECODE_FILE ]]; then
  echo "Result already exist at $RECODE_FILE"
  exit 1
fi

echo
echo "VCF file: $VCF_FILE"
echo "Recode VCF file: $RECODE_FILE"
echo

if [[ $VCF_FILE =~ .*\.vcf\.gz$ ]]; then
  exec vcftools --gzvcf "$VCF_FILE" --remove-indels --recode --recode-INFO-all --out $NAME
fi

if [[ $VCF_FILE =~ .*\.vcf$ ]]; then
  exec vcftools --vcf "$VCF_FILE" --remove-indels --recode --recode-INFO-all --out $NAME
fi

echo "File must ends with .vcf or .vcf.gz"
exit 1
